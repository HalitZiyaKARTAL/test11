deleter() { local S="$1" D="$2" I="$3" P="${4:-8022}" L="$5" H="$6" TL="$7"; [ -z "$S" ] && echo "Using $(pwd)" || { echo "CD $S"; cd "$S" || return 1; }; { touch t1 t2 t3 t4; echo -e "\033[1;34m--- STEP 1: Slicing List ---\033[0m"; head -n "$H" "$L" | tail -n "$TL" | tr -d '\r' > t1; local TOT=$(awk 'END {print NR}' t1); local CNT=0 FOUND=0 LAST=0 NOW=0; echo -e "\033[1;34m--- STEP 2: Local Scan ---\033[0m"; printf "\r> Scanned: 0 / %d | Found: 0" "$TOT" >&2; while read -r f || [ -n "$f" ]; do [ -z "$f" ] && continue; if [ -f "$f" ]; then echo "$f"; ((FOUND++)); fi; ((CNT++)); NOW=${EPOCHREALTIME/./}; if ((CNT==1 || NOW-LAST>=30000)); then printf "\r> Scanned: %d / %d | Found: \033[1;33m%d\033[0m" "$CNT" "$TOT" "$FOUND" >&2; LAST=$NOW; fi; done < t1 > t2; printf "\r> Local Scan: \033[1;32mDONE\033[0m. Found \033[1;32m%d\033[0m existing files. \033[K\n" "$FOUND" >&2; echo -e "\033[1;34m--- STEP 3: Remote Scan ---\033[0m"; CNT=0; LAST=0; printf "\r> Found Remote: 0" >&2; cat t1 | ssh -p "$P" "$I" "cd \"$D\" && while read -r r || [ -n \"\$r\" ]; do [ -z \"\$r\" ] && continue; [ -f \"\$r\" ] && echo \"\$r\"; done" | while read -r f || [ -n "$f" ]; do [ -z "$f" ] && continue; echo "$f"; ((CNT++)); NOW=${EPOCHREALTIME/./}; if ((CNT==1 || NOW-LAST>=30000)); then printf "\r> Found Remote: \033[1;32m%d\033[0m" "$CNT" >&2; LAST=$NOW; fi; done > t3; printf "\r> Remote Scan: \033[1;32mDONE\033[0m. Found \033[1;32m%d\033[0m matches. \033[K\n" "$CNT" >&2; grep -Fxf t3 t2 > t4 || true; echo -e "\n\033[1;36m=== SUMMARY ===\033[0m\nRequested  : $TOT\nFound Here : $(wc -l < t2)\nFound Remote: $(wc -l < t3)\n\033[1;31mTO DELETE  : $(wc -l < t4)\033[0m (Overlap)\n----------------\nFirst: $(head -n 1 t4)\nLast : $(tail -n 1 t4)\n"; read -p "Delete 'TO DELETE' files? (y/n) " c; [ "$c" = "y" ] && xargs -d '\n' -a t4 rm -v; rm t1 t2 t3 t4; }; }
