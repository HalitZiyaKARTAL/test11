richcopy(){ local S="$1" D="$2" I="$3" P="${4:-8022}"; [ "$#" -lt 2 ]&&{ echo -e "\033[1;33mUsage: richcopy <SRC> <DEST> [IP] [PORT]\033[0m";return 1;}; if [ ! -d "$D" ];then read -p "⚠️ Create dest: $D? [y/N] " c;[[ "$c" != "y" ]]&&return 1;mkdir -p "$D";fi; if [ -z "$I" ];then read -p "Local copy? [y/N] " c;[[ "$c" != "y" ]]&&return 1;cp -av "$S/." "$D/"&&echo "✅ Done.";return 0;fi; echo "[1/2] Syncing...";rsync -rh --info=progress2 -e "ssh -p $P" $I:$(echo "$S"|sed 's/ /\\ /g')/ "$D/"; echo "[2/2] Restoring Nanoseconds...";adb -s $I shell "cd '$S' && find . -exec stat -c '%n|%x|%y' {} +"|while IFS='|' read -r p a m;do p=$(echo "$p"|tr -d '\r');a=$(echo "$a"|tr -d '\r');m=$(echo "$m"|tr -d '\r');f="$D/${p#./}";[[ -e "$f" ]]&&{ [[ "$a" == *"20"* ]]&&touch -a -d "$a" "$f";[[ "$m" == *"20"* ]]&&touch -m -d "$m" "$f";};done;echo "✅ Done.";};richcopy;
