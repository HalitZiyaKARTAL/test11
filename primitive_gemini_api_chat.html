<!DOCTYPE html><html><head><title>AI Chat</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}body{font-family:monospace;margin:10px}.container{display:flex;align-items:center;flex-wrap:wrap;margin-bottom:10px}.control-group{display:inline-flex;align-items:center;gap:2px;margin-right:3px;margin-bottom:10px}input,textarea,button{background-color:#333;color:#e0e0e0;border:1px solid #555;padding:8px}textarea,button{width:100%;margin-bottom:10px}button{cursor:pointer}button:disabled{background-color:#222;color:#777}.container input[type="text"],.container input[type="number"],.colours-dropdown-content input[type="text"]{field-sizing:content}input:disabled{background-color:#2a2a2a;color:#888}#b{height:65vh;overflow-y:scroll;border:1px solid;padding:10px;margin:10px 0}#b pre{white-space:pre-wrap;margin:5px 0;padding:4px;border:1px solid}code{padding:1px 4px;border-radius:4px}.dropdown-container,.colours-dropdown-container{position:relative;display:inline-flex;align-items:center}#chatid{padding-right:25px}#id-dropdown-btn{position:absolute;right:0;top:0;bottom:0;display:flex;align-items:center;width:25px;justify-content:center;cursor:pointer;user-select:none}.dropdown-content{display:none;position:absolute;top:100%;left:0;background-color:#444;min-width:160px;border:1px solid #555;z-index:1;max-height:80vh;overflow-y:auto}.dropdown-content div{color:#e0e0e0;padding:8px 12px;text-decoration:none;display:block;cursor:pointer}.dropdown-content div:hover{background-color:#555}.show{display:block}#save-btn,#colours-btn{width:auto;margin-bottom:0;padding:4px 8px}.colours-dropdown-content{padding:10px;max-width:95vw}.colours-dropdown-content table{width:100%;border-collapse:collapse}.colours-dropdown-content td{padding:1px 0}.colours-dropdown-content td:last-child{white-space:nowrap}.colours-dropdown-content input[type="text"]{width:auto;text-align:right}.colours-dropdown-content input[type="color"]{width:25px;padding:0;background:none;border:1px solid #555;cursor:pointer}.colours-dropdown-content input[type="color"]::-webkit-color-swatch{border:none}.colours-dropdown-content input[type="color"]::-moz-color-swatch{border:none}#b h1,#b h2,#b h3,#b h4,#b h5,#b h6{margin:.8em 0 .4em}#b p{margin:0}#b p+p{margin-top:.5em}#b blockquote{background-color:#2a2a2a;border-left:4px solid #555;border-radius:0 4px 4px 0;margin:10px 0;padding:5px 15px}#b hr{border:0;border-top:1px solid #444;margin:1em 0}#b pre div pre{margin:10px 0;border:1px solid}#b pre div pre code{display:block;padding:10px;border-radius:4px;white-space:pre-wrap;color:#e0e0e0}#b pre > div{display:inline}#b ul,#b ol{margin:0;padding-left:20px}</style></head><body><div class="container"><span class="control-group"><label for="key">API Key:</label><input type="text" id="key" data-state="key"></span><span class="control-group"><label for="model">Model Name:</label><input type="text" id="model" data-state="model"></span><span class="control-group"><label for="chatid">Chat ID:</label><div class="dropdown-container"><input type="text" id="chatid" data-state="chatid" data-event="change"><label for="chatid" id="id-dropdown-btn" data-action="toggle" data-target="idMenu">â–¼</label><div id="id-dropdown-menu" class="dropdown-content"></div></div></span><span class="control-group"><div class="colours-dropdown-container"><button id="colours-btn" data-action="toggle" data-target="colorMenu">Colours</button><div id="colours-dropdown" class="dropdown-content colours-dropdown-content"></div></div></span><span class="control-group"><label for="parse">Parse:</label><input type="checkbox" id="parse" data-state="parse"></span><span class="control-group"><label for="stream">Stream:</label><input type="checkbox" id="stream" data-state="stream"></span><span class="control-group"><input type="number" id="ms" data-state="ms">ms</span><span class="control-group"><span><button id="save-btn" data-action="save">Save</button>:</span><label for="savesettings">Settings</label><input type="checkbox" id="savesettings" data-state="savesettings"><label for="savechat">Chat</label><input type="checkbox" id="savechat" data-state="savechat"></span></div><div id="b"></div><textarea id="u" placeholder="Your message..."></textarea><button id="s" data-action="send">Send</button><script>const g=id=>document.getElementById(id),cE=tag=>document.createElement(tag),doc=document,s={},cfg=[{k:'username',l:'User Name',d:'#f00',s:'.user-prefix',p:'color'},{k:'modelname',l:'Model Name',d:'#f0f',s:'.model-prefix',p:'color'},{k:'usertext',l:'User Text',d:'#0f0c',s:'.user-message',p:'color'},{k:'modeltext',l:'Model Text',d:'#fecc',s:'.model-message',p:'color'},{k:'uitext',l:'UI Text',d:'#fff',s:'body, input, textarea, button',p:'color'},{k:'userbg',l:'User Background',d:'#0066',s:'.user-message',p:'backgroundColor'},{k:'modelbg',l:'Model Background',d:'#5503',s:'.model-message',p:'backgroundColor'},{k:'background',l:'Background',d:'#000',s:'body',p:'backgroundColor'},{k:'useredge',l:'User Edge',d:'#0f0',s:'.user-message',p:'borderColor'},{k:'modeledge',l:'Model Edge',d:'#00f',s:'.model-message',p:'borderColor'},{k:'chatedge',l:'Chat Edge',d:'#fff',s:'#b',p:'borderColor'},{k:'codeblockedges',l:'Codeblock Edge',d:'#00f',s:'#b pre div pre',p:'borderColor'},{k:'codeblockbackground',l:'Codeblock Background',d:'#000',s:'#b pre div pre code',p:'backgroundColor'},{k:'inlinecodebackground',l:'Inline Code BG',d:'#0ff2',s:'p code, li code, h1 code, h2 code, h3 code, h4 code, h5 code, h6 code',p:'backgroundColor'}];let h={},cc=[];const pT=text=>{const e=t=>t.replace(/</g,'&lt;'),i=str=>e(str).replace(/`([^`]+)`/g,'<code>$1</code>').replace(/\*\*\*([^*]+)\*\*\*/g,'<strong><em>$1</em></strong>').replace(/\*\*([^*]+)\*\*/g,'<strong>$1</strong>').replace(/\*([^*]+)\*/g,'<em>$1</em>'),l=text.split('\n'),o=[];let iC=!1,iUL=!1,iOL=!1,ct=[];const cUL=()=>{if(iUL){o.push('</ul>');iUL=!1}},cOL=()=>{if(iOL){o.push('</ol>');iOL=!1}};for(const ln of l){if(iC){if(/```\s*$/.test(ln)){const fI=ln.lastIndexOf('```'),lastLine=ln.substring(0,fI);if(lastLine)ct.push(lastLine);o.push(`<pre><code>${e(ct.join('\n'))}</code></pre>`);iC=!1}else{ct.push(ln)}}else{const oM=ln.match(/^\s*```(.+)/),ulM=ln.match(/^\s*[\*\-\+]\s(.*)/),olM=ln.match(/^\s*\d+\.\s(.*)/),hM=ln.match(/^(#{1,6})\s(.*)/);if(!ulM&&!olM){cUL();cOL()}if(oM){cUL();cOL();iC=!0;ct=[oM[1]]}else if(hM){o.push(`<h${hM[1].length}>${i(hM[2])}</h${hM[1].length}>`)}else if(ulM){cOL();if(!iUL){o.push('<ul>');iUL=!0}o.push(`<li>${i(ulM[1])}</li>`)}else if(olM){cUL();if(!iOL){o.push('<ol>');iOL=!0}o.push(`<li>${i(olM[1])}</li>`)}else if(/^(---|___|\*\*\*)\s*$/.test(ln)){o.push('<hr>')}else if(ln.startsWith('> ')){o.push(`<blockquote>${i(ln.substring(2))}</blockquote>`)}else if(ln.trim()){o.push(`<p>${i(ln)}</p>`)}}}cUL();cOL();if(iC)o.push(`<pre><code>${e(ct.join('\n'))}</code></pre>`);return o.filter(Boolean).join('').replace(/<\/blockquote><blockquote>/g,'<br>').replace(/<\/p><p>/g,'<br>')},cH=c=>{try{const t=cE('div');t.style.color=c;doc.body.appendChild(t);const rC=window.getComputedStyle(t).color;t.remove();if(rC.startsWith('#'))return rC;const rgb=rC.match(/\d+/g).map(Number);return`#${((1<<24)+(rgb[0]<<16)+(rgb[1]<<8)+rgb[2]).toString(16).slice(1)}`}catch(e){return'#000000'}},rC=(pre,ct,text,iP)=>{pre.style.whiteSpace=iP?'normal':'pre-wrap';ct[iP?'innerHTML':'textContent']=iP?pT(text):text},cME=(role,text)=>{const p=cE('pre'),iU=role==='user',pS=cE('span'),ct=cE('div');p.className=iU?'user-message':'model-message';pS.className=iU?'user-prefix':'model-prefix';pS.textContent=iU?'user: ':`${s.model.replace(/</g,"&lt;")}: `;rC(p,ct,text,!iU&&s.parse);p.append(pS,ct);return p},r=()=>{const b=g('b');b.innerHTML='';cc.length?cc.forEach(msg=>b.appendChild(cME(msg.role,msg.parts[0].text))):b.insertAdjacentHTML('beforeend','<pre>System: Enter API key & ask a question.</pre>');Object.keys(s).forEach(k=>{const el=g(k);if(el)el[el.type==='checkbox'?'checked':'value']=s[k]});g('ms').disabled=!s.stream;cfg.forEach(c=>{const k=c.k,val=s.colours[k];doc.querySelector(`[data-state="colours.${k}"][type="text"]`).value=val;doc.querySelector(`[data-state="colours.${k}"][type="color"]`).value=cH(val)});cfg.forEach(c=>doc.querySelectorAll(c.s).forEach(el=>el.style[c.p]=s.colours[c.k]));const idMenu=g('id-dropdown-menu');if(s.ui.idMenu)idMenu.innerHTML=Object.keys(h).map(id=>`<div data-action="selectChat" data-id="${id}">${id}</div>`).join('');idMenu.classList.toggle('show',s.ui.idMenu);g('colours-dropdown').classList.toggle('show',s.ui.colorMenu)},a={send:async()=>{const uM=g('u').value.trim();if(!s.key||!s.model||!uM)return;const b=g('b'),sB=g('s');cc.push({role:'user',parts:[{text:uM}]});r();const mM=cME('model','...');b.appendChild(mM);g('u').value='';sB.disabled=!0;let fR='';try{const eP=s.stream?'streamGenerateContent?alt=sse&':'generateContent?',res=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${s.model}:${eP}key=${s.key}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:cc})});if(!res.ok)throw new Error((await res.json()).error.message);const uUI=t=>{rC(mM,mM.lastChild,t,s.parse);b.scrollTop=b.scrollHeight};if(s.stream){const rdr=res.body.getReader(),d=new TextDecoder();for(let bf='';;){const{done,value}=await rdr.read();if(done)break;bf+=d.decode(value,{stream:!0});const lns=bf.split('\n');bf=lns.pop();for(const ln of lns)ln.startsWith('data: ')&&(fR+=JSON.parse(ln.substring(6)).candidates?.[0]?.content?.parts?.[0]?.text||'');uUI(fR);if(s.ms>0)await new Promise(r=>setTimeout(r,s.ms))}}else{fR=(await res.json()).candidates[0].content.parts[0].text;uUI(fR)}cc.push({role:'model',parts:[{text:fR}]});a.save();r()}catch(err){mM.textContent=`${s.model}: Error - ${err.message}`}finally{sB.disabled=!1;g('u').focus()}},save:()=>{if(s.savesettings||s.savechat)localStorage.setItem('chat',JSON.stringify({s:s.savesettings?s:undefined,history:s.savechat?h:undefined}))},toggle:el=>{s.ui[el.dataset.target]=!s.ui[el.dataset.target];r()},selectChat:el=>{s.chatid=el.dataset.id;s.ui.idMenu=!1;cc=h[s.chatid]||(h[s.chatid]=[]);r()}};['input','change'].forEach(evt=>doc.addEventListener(evt,e=>{const el=e.target,reqEvt=el.dataset.event||'input';if(evt!==reqEvt)return;const kP=el.dataset.state;if(!kP)return;const keys=kP.split('.'),val=el.type.slice(0,8)==='checkbox'?el.checked:el.value;let cS=s;for(let i=0;i<keys.length-1;i++)cS=cS[keys[i]];cS[keys[keys.length-1]]=val;if(kP==='chatid')cc=h[s.chatid]||(h[s.chatid]=[]);r()}));doc.addEventListener('click',e=>{const act=e.target.dataset.action;if(a[act])a[act](e.target);if(!e.target.closest('.dropdown-container')&&!e.target.closest('.colours-dropdown-container')){if(s.ui.idMenu||s.ui.colorMenu){s.ui.idMenu=!1;s.ui.colorMenu=!1;r()}}});(()=>{const st=JSON.parse(localStorage.getItem('chat'))||{},sS=st.s||{},sH=st.history||{};Object.assign(s,{key:"",model:"gemini-1.5-pro-latest",chatid:"default",parse:!1,stream:!1,ms:50,savesettings:!0,savechat:!0,ui:{idMenu:!1,colorMenu:!1},...sS});s.colours={...cfg.reduce((a,c)=>({...a,[c.k]:c.d}),{}),...(sS.colours||{})};g('colours-dropdown').innerHTML='<table>'+cfg.map(c=>`<tr><td><input type="color" data-state="colours.${c.k}"></td><td><input type="text" data-state="colours.${c.k}"></td><td>=> ${c.l}</td></tr>`).join('')+'</table>';h=Array.isArray(sH)?confirm("Warning: Outdated chat data format detected.\n\nClick OK to migrate your old chat to a new format under the ID 'oldlocal'. This is recommended.\n\nClick Cancel to do nothing. The app may not function correctly with the old data.")?{default:[],oldlocal:sH}:sH:typeof sH==='object'?sH:{default:[]};cc=h[s.chatid]||(h[s.chatid]=[]);r()})();</script></body></html>
