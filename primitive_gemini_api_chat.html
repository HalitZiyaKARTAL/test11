<!DOCTYPE html><html><head><title>AI Chat</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}body{background-color:var(--background-color, #121212);color:var(--modeltext-color, #e0e0e0);font-family:monospace;margin:10px}.container{display:flex;align-items:center;flex-wrap:wrap;margin-bottom:10px}.control-group{display:inline-flex;align-items:center;gap:2px;margin-right:3px;margin-bottom:10px}input,textarea,button{background-color:#333;color:var(--modeltext-color, #e0e0e0);border:1px solid #555;padding:8px}textarea,button{width:100%;margin-bottom:10px}button{cursor:pointer}button:disabled{background-color:#222;color:#777}.container input[type="text"],.container input[type="number"]{field-sizing:content}input:disabled{background-color:#2a2a2a;color:#888}#b{height:65vh;overflow-y:scroll;border:1px solid #444;padding:10px;margin:10px 0}#b pre{white-space:pre-wrap;margin:5px 0;padding:4px;}code{background-color:#000;padding:1px 4px;border-radius:4px}.dropdown-container,.colours-dropdown-container{position:relative;display:inline-flex;align-items:center}#cid{padding-right:25px}#id-dropdown-btn{position:absolute;right:0;top:0;bottom:0;display:flex;align-items:center;width:25px;justify-content:center;cursor:pointer;user-select:none}.dropdown-content{display:none;position:absolute;top:100%;left:0;background-color:#444;min-width:160px;border:1px solid #555;z-index:1;max-height:80vh;overflow-y:auto}.dropdown-content div{color:#e0e0e0;padding:8px 12px;text-decoration:none;display:block;cursor:pointer}.dropdown-content div:hover{background-color:#555}.show{display:block}#save-btn,#colours-btn{width:auto;margin-bottom:0;padding:4px 8px;}.colours-dropdown-content{padding:10px;width:250px;}.colour-input-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;}.colour-input-row input{width:100px;}#b pre.user-message{color:var(--usertext-color, lime);background-color:var(--userbg-color, transparent);}#b pre.user-message::before{content:'user: ';color:var(--username-color, red);}#b pre.model-message{color:var(--modeltext-color, #e0e0e0);background-color:var(--modelbg-color, transparent);}#b .model-prefix{color:var(--modelname-color, violet);}</style></head><body><div class="container"><span class="control-group"><label for="i">API Key:</label><input type="text" id="i" oninput="s.key=this.value"></span><span class="control-group"><label for="m">Model Name:</label><input type="text" id="m" oninput="s.model=this.value"></span><span class="control-group"><label for="cid">Chat ID:</label><div class="dropdown-container"><input type="text" id="cid" onchange="const newId=this.value;if(!newId||newId===s.chatid)return;s.chatid=newId;if(!history[newId])history[newId]=[];currentChat=history[newId];renderHistory();g('save-btn').click()"><label for="cid" id="id-dropdown-btn" onclick="const menu=g('id-dropdown-menu');menu.innerHTML='';Object.keys(history).forEach(id=>{const item=document.createElement('div');item.textContent=id;item.onclick=()=>{const cidInput=g('cid');cidInput.value=id;cidInput.dispatchEvent(new Event('change'));menu.classList.remove('show')};menu.appendChild(item)});menu.classList.toggle('show')">â–¼</label><div id="id-dropdown-menu" class="dropdown-content"></div></div></span><span class="control-group"><label for="p">Parse:</label><input type="checkbox" id="p" onclick="s.parse=this.checked"></span><span class="control-group"><label for="st">Stream:</label><input type="checkbox" id="st" onclick="s.stream=this.checked;g('si').disabled=!this.checked"></span><span class="control-group"><input type="number" id="si" oninput="s.ms=this.value">ms</span><span class="control-group"><span><button id="save-btn" onclick="if(s.savesettings||s.savechat)localStorage.setItem('chat',JSON.stringify({s:s,history:history}))">Save</button>:</span><label for="savesettings">Settings</label><input type="checkbox" id="savesettings" onclick="s.savesettings=this.checked"><label for="savechat">Chat</label><input type="checkbox" id="savechat" onclick="s.savechat=this.checked"></span><span class="control-group"><div class="colours-dropdown-container"><button id="colours-btn" onclick="g('colours-dropdown').classList.toggle('show')">Colours</button><div id="colours-dropdown" class="dropdown-content colours-dropdown-content"><div class="colour-input-row"><label for="c-username">User Name:</label><input type="text" id="c-username" oninput="s.colours.username=this.value;syncColoursToCss()"></div><div class="colour-input-row"><label for="c-modelname">Model Name:</label><input type="text" id="c-modelname" oninput="s.colours.modelname=this.value;syncColoursToCss()"></div><div class="colour-input-row"><label for="c-usertext">User Text:</label><input type="text" id="c-usertext" oninput="s.colours.usertext=this.value;syncColoursToCss()"></div><div class="colour-input-row"><label for="c-modeltext">Model Text:</label><input type="text" id="c-modeltext" oninput="s.colours.modeltext=this.value;syncColoursToCss()"></div><div class="colour-input-row"><label for="c-userbg">User BG:</label><input type="text" id="c-userbg" oninput="s.colours.userbg=this.value;syncColoursToCss()"></div><div class="colour-input-row"><label for="c-modelbg">Model BG:</label><input type="text" id="c-modelbg" oninput="s.colours.modelbg=this.value;syncColoursToCss()"></div><div class="colour-input-row"><label for="c-background">BG:</label><input type="text" id="c-background" oninput="s.colours.background=this.value;syncColoursToCss()"></div></div></div></span></div><div id="b"></div><textarea id="u" placeholder="Your message..." rows="3"></textarea><button id="s" onclick="(async()=>{g('save-btn').click();const userMessage=g('u').value.trim();if(!s.key||!s.model||!userMessage)return;const b=g('b');const userPre=document.createElement('pre');userPre.className='user-message';userPre.textContent=userMessage;b.appendChild(userPre);const modelPre=document.createElement('pre');modelPre.className='model-message';const modelPrefix=document.createElement('span');modelPrefix.className='model-prefix';modelPrefix.textContent=`${s.model.replace(/</g,'&lt;')}: `;modelPre.appendChild(modelPrefix);modelPre.appendChild(document.createTextNode('...'));b.appendChild(modelPre);const modelMessage=modelPre;g('u').value='',g('s').disabled=!0;currentChat.push({role:'user',parts:[{text:userMessage}]});let fullResponse='';try{const endpoint=s.stream?'streamGenerateContent?alt=sse&':'generateContent?';const response=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${s.model}:${endpoint}key=${s.key}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:currentChat})});if(!response.ok)throw new Error((await response.json()).error.message);const updateUI=text=>{modelMessage.innerHTML='';const modelPrefix=document.createElement('span');modelPrefix.className='model-prefix';modelPrefix.textContent=`${s.model.replace(/</g,'&lt;')}: `;modelMessage.appendChild(modelPrefix);modelMessage.appendChild(document.createTextNode(text));b.scrollTop=b.scrollHeight};if(s.stream){const reader=response.body.getReader(),decoder=new TextDecoder();for(let buffer='';;){const{done,value}=await reader.read();if(done)break;buffer+=decoder.decode(value,{stream:!0});const lines=buffer.split('\n');buffer=lines.pop();for(const line of lines){if(line.startsWith('data: '))fullResponse+=JSON.parse(line.substring(6)).candidates?.[0]?.content?.parts?.[0]?.text||''};updateUI(fullResponse);if(s.ms>0)await new Promise(r=>setTimeout(r,s.ms))}}else{fullResponse=(await response.json()).candidates[0].content.parts[0].text;updateUI(fullResponse)}currentChat.push({role:'model',parts:[{text:fullResponse}]});g('save-btn').click()}catch(error){modelMessage.textContent=`${s.model}: Error - ${error.message}`}finally{g('s').disabled=!1,g('u').focus()}})()">Send</button><script>const g=id=>document.getElementById(id);const storedData=JSON.parse(localStorage.getItem('chat'))||{};let historyData=storedData.history;if(Array.isArray(historyData)){if(confirm("Warning: Outdated chat data format detected.\n\nClick OK to migrate your old chat to a new format under the ID 'oldlocal'.\n\nClick Cancel to do nothing (app may not function).")){const preservedChat=historyData;historyData={default:[],oldlocal:preservedChat}}}else if(!historyData||typeof historyData!=='object'){historyData={default:[]}};const s={key:"",model:"gemini-2.5-pro",chatid:"default",parse:false,stream:false,ms:50,savesettings:false,savechat:false,colours:{username:'red',modelname:'violet',usertext:'lime',modeltext:'#e0e0e0',userbg:'transparent',modelbg:'transparent',background:'#121212'},...(storedData.s||{})};const history=historyData;let currentChat=history[s.chatid]||[];function syncColoursToCss(){const rootStyle=document.body.style;rootStyle.setProperty('--username-color',s.colours.username);rootStyle.setProperty('--modelname-color',s.colours.modelname);rootStyle.setProperty('--usertext-color',s.colours.usertext);rootStyle.setProperty('--modeltext-color',s.colours.modeltext);rootStyle.setProperty('--userbg-color',s.colours.userbg);rootStyle.setProperty('--modelbg-color',s.colours.modelbg);rootStyle.setProperty('--background-color',s.colours.background)};function renderHistory(){const b=g('b');b.innerHTML='';if(currentChat&&currentChat.length){for(const msg of currentChat){const escapedText=msg.parts[0].text.replace(/</g,"&lt;");if(msg.role=='user'){b.insertAdjacentHTML('beforeend',`<pre class="user-message">${escapedText}</pre>`)}else{const escapedModel=s.model.replace(/</g,"&lt;");b.insertAdjacentHTML('beforeend',`<pre class="model-message"><span class="model-prefix">${escapedModel}: </span>${escapedText}</pre>`)}}}else{b.insertAdjacentHTML('beforeend','<pre>System: Enter API key & ask a question.</pre>')}};window.onclick=function(event){if(!event.target.closest('.dropdown-container')&&!event.target.closest('.colours-dropdown-container')){g('id-dropdown-menu').classList.remove('show');g('colours-dropdown').classList.remove('show')}};g('i').value=s.key;g('m').value=s.model;g('cid').value=s.chatid;g('p').checked=s.parse;g('st').checked=s.stream;g('si').value=s.ms;g('si').disabled=!s.stream;g('savesettings').checked=s.savesettings;g('savechat').checked=s.savechat;g('c-username').value=s.colours.username;g('c-modelname').value=s.colours.modelname;g('c-usertext').value=s.colours.usertext;g('c-modeltext').value=s.colours.modeltext;g('c-userbg').value=s.colours.userbg;g('c-modelbg').value=s.colours.modelbg;g('c-background').value=s.colours.background;syncColoursToCss();renderHistory();</script></body></html>
