<!DOCTYPE html><html><head><title>AI Chat</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}body{font-family:monospace;margin:10px}.container{display:flex;align-items:center;flex-wrap:wrap;margin-bottom:10px}.control-group{display:inline-flex;align-items:center;gap:2px;margin-right:3px;margin-bottom:10px}input,textarea,button{background-color:#333;color:#e0e0e0;border:1px solid #555;padding:8px}textarea,button{width:100%;margin-bottom:10px}button{cursor:pointer}button:disabled{background-color:#222;color:#777}.container input[type="text"],.container input[type="number"]{field-sizing:content}input:disabled{background-color:#2a2a2a;color:#888}#b{height:65vh;overflow-y:scroll;border:1px solid;padding:10px;margin:10px 0}#b pre{white-space:pre-wrap;margin:5px 0;padding:4px;border:1px solid}code{background-color:transparent;padding:1px 4px;border-radius:4px}.dropdown-container,.colours-dropdown-container{position:relative;display:inline-flex;align-items:center}#cid{padding-right:25px}#id-dropdown-btn{position:absolute;right:0;top:0;bottom:0;display:flex;align-items:center;width:25px;justify-content:center;cursor:pointer;user-select:none}.dropdown-content{display:none;position:absolute;top:100%;left:0;background-color:#444;min-width:160px;border:1px solid #555;z-index:1;max-height:80vh;overflow-y:auto}.dropdown-content div{color:#e0e0e0;padding:8px 12px;text-decoration:none;display:block;cursor:pointer}.dropdown-content div:hover{background-color:#555}.show{display:block}#save-btn,#colours-btn{width:auto;margin-bottom:0;padding:4px 8px}.colours-dropdown-content{padding:10px;width:280px}.colour-input-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:1px}.colour-input-group{display:flex;align-items:center;gap:5px}.colour-input-group input[type="text"]{width:100px}.colour-input-group input[type="color"]{width:30px;height:30px;padding:2px;border:1px solid #555;background:none}#b h1,#b h2,#b h3,#b h4,#b h5,#b h6{margin:.8em 0 .4em}#b p{margin:0}#b p+p{margin-top:.5em}#b blockquote{background-color:#2a2a2a;border-left:4px solid #555;border-radius:0 4px 4px 0;margin:10px 0;padding:5px 15px}#b hr{border:0;border-top:1px solid #444;margin:1em 0}#b pre div pre{margin:10px 0;border:1px solid}#b pre div pre code{display:block;padding:10px;border-radius:4px;white-space:pre-wrap;color:#e0e0e0}#b pre > div{display:inline}#b ul{margin:0;padding-left:20px}</style></head><body><div class="container"><span class="control-group"><label for="i">API Key:</label><input type="text" id="i" oninput="s.key=this.value"></span><span class="control-group"><label for="m">Model Name:</label><input type="text" id="m" oninput="s.model=this.value"></span><span class="control-group"><label for="cid">Chat ID:</label><div class="dropdown-container"><input type="text" id="cid" onchange="const newId=this.value;if(!newId||newId===s.chatid)return;s.chatid=newId;if(!history[newId])history[newId]=[];currentChat=history[newId];renderHistory();g('save-btn').click()"><label for="cid" id="id-dropdown-btn" onclick="const menu=g('id-dropdown-menu');menu.innerHTML=Object.keys(history).map(id=>`<div>${id}</div>`).join('');[...menu.children].forEach(item=>{item.onclick=()=>{g('cid').value=item.textContent;g('cid').dispatchEvent(new Event('change'));menu.classList.remove('show')}});menu.classList.toggle('show')">â–¼</label><div id="id-dropdown-menu" class="dropdown-content"></div></div></span><span class="control-group"><label for="p">Parse:</label><input type="checkbox" id="p" onclick="s.parse=this.checked; renderHistory()"></span><span class="control-group"><label for="st">Stream:</label><input type="checkbox" id="st" onclick="s.stream=this.checked;g('si').disabled=!this.checked"></span><span class="control-group"><input type="number" id="si" oninput="s.ms=this.value">ms</span><span class="control-group"><span><button id="save-btn" onclick="if(s.savesettings||s.savechat)localStorage.setItem('chat',JSON.stringify({s:s,history:history}))">Save</button>:</span><label for="savesettings">Settings</label><input type="checkbox" id="savesettings" onclick="s.savesettings=this.checked"><label for="savechat">Chat</label><input type="checkbox" id="savechat" onclick="s.savechat=this.checked"></span><span class="control-group"><div class="colours-dropdown-container"><button id="colours-btn" onclick="g('colours-dropdown').classList.toggle('show')">Colours</button><div id="colours-dropdown" class="dropdown-content colours-dropdown-content"></div></div></span></div><div id="b"></div><textarea id="u" placeholder="Your message..." rows="3"></textarea><button id="s" onclick="(async()=>{g('save-btn').click();const userMessage=g('u').value.trim();if(!s.key||!s.model||!userMessage)return;const b=g('b');b.appendChild(createMessageElement('user',userMessage));const modelMessage=createMessageElement('model','...');b.appendChild(modelMessage);applyColours();g('u').value='',g('s').disabled=!0;currentChat.push({role:'user',parts:[{text:userMessage}]});let fullResponse='';try{const endpoint=s.stream?'streamGenerateContent?alt=sse&':'generateContent?';const response=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${s.model}:${endpoint}key=${s.key}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:currentChat})});if(!response.ok)throw new Error((await response.json()).error.message);const updateUI=text=>{const prefix=modelMessage.firstChild;modelMessage.textContent='';modelMessage.appendChild(prefix);modelMessage.style.whiteSpace=s.parse?'normal':'pre-wrap';modelMessage.appendChild(s.parse?(d=>{d.innerHTML=parseText(text);return d})(document.createElement('div')):document.createTextNode(text));b.scrollTop=b.scrollHeight};if(s.stream){const reader=response.body.getReader(),decoder=new TextDecoder();for(let buffer='';;){const{done,value}=await reader.read();if(done)break;buffer+=decoder.decode(value,{stream:!0});const lines=buffer.split('\n');buffer=lines.pop();for(const line of lines)line.startsWith('data: ')&&(fullResponse+=JSON.parse(line.substring(6)).candidates?.[0]?.content?.parts?.[0]?.text||'');updateUI(fullResponse);s.ms>0&&await new Promise(r=>setTimeout(r,s.ms))}}else{fullResponse=(await response.json()).candidates[0].content.parts[0].text;updateUI(fullResponse)}currentChat.push({role:'model',parts:[{text:fullResponse}]});g('save-btn').click()}catch(error){modelMessage.textContent=`${s.model}: Error - ${error.message}`}finally{g('s').disabled=!1,g('u').focus()}})()">Send</button><script>const g=id=>document.getElementById(id);const storedData=JSON.parse(localStorage.getItem('chat'))||{};let historyData=storedData.history;if(Array.isArray(historyData)){confirm("Warning: Outdated chat data format detected.\n\nClick OK to migrate to 'oldlocal'.\nClick Cancel to do nothing.")&&(historyData={default:[],oldlocal:historyData})}else if(!historyData||typeof historyData!=='object'){historyData={default:[]}};const s={key:"",model:"gemini-2.5-pro-latest",chatid:"default",parse:false,stream:false,ms:50,savesettings:false,savechat:false,colours:{},...(storedData.s||{})};const colorConfig=[{key:'username',label:'User Name',default:'#ff0000',selector:'.user-prefix',prop:'color'},{key:'modelname',label:'Model Name',default:'#8a2be2',selector:'.model-prefix',prop:'color'},{key:'usertext',label:'User Text',default:'#00ff00',selector:'.user-message',prop:'color'},{key:'modeltext',label:'Model Text',default:'#e0e0e0',selector:'.model-message',prop:'color'},{key:'uitext',label:'UI Text',default:'#e0e0e0',selector:'body, input, textarea, button',prop:'color'},{key:'userbg',label:'User BG',default:'#1a1a1a',selector:'.user-message',prop:'backgroundColor'},{key:'modelbg',label:'Model BG',default:'#1a1a1a',selector:'.model-message',prop:'backgroundColor'},{key:'background',label:'BG',default:'#121212',selector:'body',prop:'backgroundColor'},{key:'useredge',label:'User Edge',default:'transparent',selector:'.user-message',prop:'borderColor'},{key:'modeledge',label:'Model Edge',default:'transparent',selector:'.model-message',prop:'borderColor'},{key:'chatedge',label:'Chat Edge',default:'#444444',selector:'#b',prop:'borderColor'},{key:'codeblockedges',label:'Code Edge',default:'#444444',selector:'#b pre div pre',prop:'borderColor'},{key:'codeblockbackground',label:'Code BG',default:'#000000',selector:'#b pre div pre code',prop:'backgroundColor'}];s.colours={...colorConfig.reduce((a,c)=>({...a,[c.key]:c.default}),{}),...(s.colours||{})};const history=historyData;let currentChat=history[s.chatid]||[];function parseText(text){const e=t=>t.replace(/</g,'&lt;');const inline=str=>e(str).replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\*(.*?)\*/g,'<em>$1</em>').replace(/`(.*?)`/g,'<code>$1</code>');const lines=text.split('\n');const output=[];let inCode=false,inList=false,lang='',content=[];const closeList=()=>{if(inList){output.push('</ul>');inList=false}};for(const line of lines){if(inCode){if(/^```$/.test(line)){output.push(`<pre><code class="language-${lang}">${e(content.join('\n'))}</code></pre>`);inCode=false}else{content.push(line)}}else{const listMatch=line.match(/^\s*[\*\-\+]\s(.*)/);const codeMatch=line.match(/^```(\w*)/);const headingMatch=line.match(/^(#{1,6})\s(.*)/);if(!listMatch)closeList();if(codeMatch){closeList();inCode=true;lang=codeMatch[1]||'';content=[]}else if(listMatch){if(!inList){output.push('<ul>');inList=true}output.push(`<li>${inline(listMatch[1])}</li>`)}else if(headingMatch){output.push(`<h${headingMatch[1].length}>${inline(headingMatch[2])}</h${headingMatch[1].length}>`)}else if(/^(---|___|\*\*\*)\s*$/.test(line)){output.push('<hr>')}else if(line.startsWith('> ')){output.push(`<blockquote>${inline(line.substring(2))}</blockquote>`)}else if(line.trim()){output.push(`<p>${inline(line)}</p>`)}}}closeList();if(inCode)output.push(`<pre><code class="language-${lang}">${e(content.join('\n'))}</code></pre>`);return output.filter(Boolean).join('').replace(/<\/blockquote><blockquote>/g,'<br>').replace(/<\/p><p>/g,'<br>')} function colorToHex(color){const temp=document.createElement('div');temp.style.color=color;document.body.appendChild(temp);const rgbColor=window.getComputedStyle(temp).color;temp.remove();if(rgbColor.startsWith('#'))return rgbColor;const rgb=rgbColor.match(/\d+/g).map(Number);return`#${((1<<24)+(rgb[0]<<16)+(rgb[1]<<8)+rgb[2]).toString(16).slice(1)}`} function createMessageElement(role,text){const pre=document.createElement('pre');const prefixSpan=document.createElement('span');const isUser=role==='user';pre.className=isUser?'user-message':'model-message';prefixSpan.className=isUser?'user-prefix':'model-prefix';prefixSpan.textContent=isUser?'user: ':`${s.model.replace(/</g,"&lt;")}: `;pre.appendChild(prefixSpan);if(role==='model'&&s.parse){const content=document.createElement('div');content.innerHTML=parseText(text);pre.appendChild(content);pre.style.whiteSpace='normal'}else{pre.appendChild(document.createTextNode(text.replace(/</g,"&lt;")))};return pre} function applyColours(){colorConfig.forEach(c=>{document.querySelectorAll(c.selector).forEach(el=>{el.style[c.prop]=s.colours[c.key]})})} function updateColour(key,value,apply=true){s.colours[key]=value;const hexValue=colorToHex(value);g(`c-${key}-text`).value=value;try{g(`c-${key}-color`).value=hexValue}catch(e){};apply&&applyColours()} function renderHistory(){const b=g('b');b.innerHTML='';currentChat.length?currentChat.forEach(msg=>b.appendChild(createMessageElement(msg.role,msg.parts[0].text))):b.insertAdjacentHTML('beforeend','<pre>System: Enter API key & ask a question.</pre>');applyColours()} function initComponents(){g('colours-dropdown').innerHTML=colorConfig.map(c=>`<div class="colour-input-row"><label for="c-${c.key}-text">${c.label}:</label><div class="colour-input-group"><input type="text" id="c-${c.key}-text" oninput="updateColour('${c.key}',this.value)"><input type="color" id="c-${c.key}-color" oninput="updateColour('${c.key}',this.value)"></div></div>`).join('');const initValues={i:'key',m:'model',cid:'chatid',p:'parse',st:'stream',si:'ms',savesettings:'savesettings',savechat:'savechat'};Object.entries(initValues).forEach(([id,key])=>g(id)[id==='p'||id==='st'||id.startsWith('save')?'checked':'value']=s[key]);g('si').disabled=!s.stream;Object.entries(s.colours).forEach(([key,value])=>updateColour(key,value,false));renderHistory()} window.onclick=function(event){if(!event.target.closest('.dropdown-container')&&!event.target.closest('.colours-dropdown-container')){g('id-dropdown-menu').classList.remove('show');g('colours-dropdown').classList.remove('show')}};initComponents();</script></body></html>
