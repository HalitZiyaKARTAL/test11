<!DOCTYPE html><html><head><title>AI Chat</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}body{font-family:monospace;margin:10px}.container{display:flex;align-items:center;flex-wrap:wrap;margin-bottom:10px}.control-group{display:inline-flex;align-items:center;gap:2px;margin-right:3px;margin-bottom:10px}input,textarea,button{background-color:#333;color:#e0e0e0;border:1px solid #555;padding:8px}textarea,button{width:100%;margin-bottom:10px}button{cursor:pointer}button:disabled{background-color:#222;color:#777}.container input[type="text"],.container input[type="number"]{field-sizing:content}input:disabled{background-color:#2a2a2a;color:#888}#b{height:65vh;overflow-y:scroll;border:1px solid #444;padding:10px;margin:10px 0}#b pre{white-space:pre-wrap;margin:5px 0;padding:4px;}code{background-color:#000;padding:1px 4px;border-radius:4px}.dropdown-container,.colours-dropdown-container{position:relative;display:inline-flex;align-items:center}#cid{padding-right:25px}#id-dropdown-btn{position:absolute;right:0;top:0;bottom:0;display:flex;align-items:center;width:25px;justify-content:center;cursor:pointer;user-select:none}.dropdown-content{display:none;position:absolute;top:100%;left:0;background-color:#444;min-width:160px;border:1px solid #555;z-index:1;max-height:80vh;overflow-y:auto}.dropdown-content div{color:#e0e0e0;padding:8px 12px;text-decoration:none;display:block;cursor:pointer}.dropdown-content div:hover{background-color:#555}.show{display:block}#save-btn,#colours-btn{width:auto;margin-bottom:0;padding:4px 8px;}.colours-dropdown-content{padding:10px;width:280px;}.colour-input-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;}.colour-input-group{display:flex;align-items:center;gap:5px;}.colour-input-group input[type="text"]{width:100px;}.colour-input-group input[type="color"]{width:30px;height:30px;padding:2px;border:1px solid #555;background:none;}</style></head><body><div class="container"><span class="control-group"><label for="i">API Key:</label><input type="text" id="i" oninput="s.key=this.value"></span><span class="control-group"><label for="m">Model Name:</label><input type="text" id="m" oninput="s.model=this.value"></span><span class="control-group"><label for="cid">Chat ID:</label><div class="dropdown-container"><input type="text" id="cid" onchange="const newId=this.value;if(!newId||newId===s.chatid)return;s.chatid=newId;if(!history[newId])history[newId]=[];currentChat=history[newId];renderHistory();g('save-btn').click()"><label for="cid" id="id-dropdown-btn" onclick="const menu=g('id-dropdown-menu');menu.innerHTML='';Object.keys(history).forEach(id=>{const item=document.createElement('div');item.textContent=id;item.onclick=()=>{g('cid').value=id;g('cid').dispatchEvent(new Event('change'));menu.classList.remove('show')};menu.appendChild(item)});menu.classList.toggle('show')">â–¼</label><div id="id-dropdown-menu" class="dropdown-content"></div></div></span><span class="control-group"><label for="p">Parse:</label><input type="checkbox" id="p" onclick="s.parse=this.checked"></span><span class="control-group"><label for="st">Stream:</label><input type="checkbox" id="st" onclick="s.stream=this.checked;g('si').disabled=!this.checked"></span><span class="control-group"><input type="number" id="si" oninput="s.ms=this.value">ms</span><span class="control-group"><span><button id="save-btn" onclick="if(s.savesettings||s.savechat)localStorage.setItem('chat',JSON.stringify({s:s,history:history}))">Save</button>:</span><label for="savesettings">Settings</label><input type="checkbox" id="savesettings" onclick="s.savesettings=this.checked"><label for="savechat">Chat</label><input type="checkbox" id="savechat" onclick="s.savechat=this.checked"></span><span class="control-group"><div class="colours-dropdown-container"><button id="colours-btn" onclick="g('colours-dropdown').classList.toggle('show')">Colours</button><div id="colours-dropdown" class="dropdown-content colours-dropdown-content"></div></div></span></div><div id="b"></div><textarea id="u" placeholder="Your message..." rows="3"></textarea><button id="s" onclick="(async()=>{g('save-btn').click();const userMessage=g('u').value.trim();if(!s.key||!s.model||!userMessage)return;const b=g('b');b.appendChild(createMessageElement('user',userMessage));const modelMessage=createMessageElement('model','...');b.appendChild(modelMessage);applyColours();g('u').value='',g('s').disabled=!0;currentChat.push({role:'user',parts:[{text:userMessage}]});let fullResponse='';try{const endpoint=s.stream?'streamGenerateContent?alt=sse&':'generateContent?';const response=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${s.model}:${endpoint}key=${s.key}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:currentChat})});if(!response.ok)throw new Error((await response.json()).error.message);const updateUI=text=>{const prefix=modelMessage.firstChild;modelMessage.textContent='';modelMessage.appendChild(prefix);modelMessage.appendChild(document.createTextNode(text));b.scrollTop=b.scrollHeight};if(s.stream){const reader=response.body.getReader(),decoder=new TextDecoder();for(let buffer='';;){const{done,value}=await reader.read();if(done)break;buffer+=decoder.decode(value,{stream:!0});const lines=buffer.split('\n');buffer=lines.pop();for(const line of lines)line.startsWith('data: ')&&(fullResponse+=JSON.parse(line.substring(6)).candidates?.[0]?.content?.parts?.[0]?.text||'');updateUI(fullResponse);s.ms>0&&await new Promise(r=>setTimeout(r,s.ms))}}else{fullResponse=(await response.json()).candidates[0].content.parts[0].text;updateUI(fullResponse)}currentChat.push({role:'model',parts:[{text:fullResponse}]});g('save-btn').click()}catch(error){modelMessage.textContent=`${s.model}: Error - ${error.message}`}finally{g('s').disabled=!1,g('u').focus()}})()">Send</button><script>const g=id=>document.getElementById(id);const storedData=JSON.parse(localStorage.getItem('chat'))||{};let historyData=storedData.history;if(Array.isArray(historyData)){confirm("Warning: Outdated chat data format detected.\n\nClick OK to migrate to 'oldlocal'.\nClick Cancel to do nothing.")&&(historyData={default:[],oldlocal:historyData})}else if(!historyData||typeof historyData!=='object'){historyData={default:[]}};const s={key:"",model:"gemini-2.5-pro",chatid:"default",parse:false,stream:false,ms:50,savesettings:false,savechat:false,colours:{username:'#ff0000',modelname:'#8a2be2',usertext:'#00ff00',modeltext:'#e0e0e0',uitext:'#e0e0e0',userbg:'#1a1a1a',modelbg:'#1a1a1a',background:'#121212'},...(storedData.s||{})};const history=historyData;let currentChat=history[s.chatid]||[];function colorToHex(color){const temp=document.createElement('div');temp.style.color=color;document.body.appendChild(temp);const rgbColor=window.getComputedStyle(temp).color;temp.remove();if(rgbColor.startsWith('#'))return rgbColor;const rgb=rgbColor.match(/\d+/g).map(Number);return`#${((1<<24)+(rgb[0]<<16)+(rgb[1]<<8)+rgb[2]).toString(16).slice(1)}`};function createMessageElement(role,text){const pre=document.createElement('pre');const prefixSpan=document.createElement('span');const textNode=document.createTextNode(text.replace(/</g,"&lt;"));const isUser=role==='user';pre.className=isUser?'user-message':'model-message';prefixSpan.className=isUser?'user-prefix':'model-prefix';prefixSpan.textContent=isUser?'user: ':`${s.model.replace(/</g,"&lt;")}: `;pre.appendChild(prefixSpan);pre.appendChild(textNode);return pre};function applyColours(){const c=s.colours;const colorMap={'body':{bg:'background',color:'uitext'},'input, textarea, button':{bg:null,color:'uitext'},'.user-message':{bg:'userbg',color:'usertext'},'.model-message':{bg:'modelbg',color:'modeltext'},'.user-prefix':{bg:null,color:'username'},'.model-prefix':{bg:null,color:'modelname'}};Object.entries(colorMap).forEach(([selector,{bg,color}])=>{document.querySelectorAll(selector).forEach(el=>{bg&&c[bg]&&(el.style.backgroundColor=c[bg]);color&&c[color]&&(el.style.color=c[color])})})};function updateColour(key,value,apply=true){s.colours[key]=value;const hexValue=colorToHex(value);g(`c-${key}-text`).value=value;try{g(`c-${key}-color`).value=hexValue}catch(e){};apply&&applyColours()};function renderHistory(){const b=g('b');b.innerHTML='';currentChat.length?currentChat.forEach(msg=>b.appendChild(createMessageElement(msg.role,msg.parts[0].text))):b.insertAdjacentHTML('beforeend','<pre>System: Enter API key & ask a question.</pre>');applyColours()};function initComponents(){const colourMenu=g('colours-dropdown');const colourLabels={username:'User Name',modelname:'Model Name',usertext:'User Text',modeltext:'Model Text',uitext:'UI Text',userbg:'User BG',modelbg:'Model BG',background:'BG'};let colourMenuHTML='';Object.keys(s.colours).forEach(key=>{colourMenuHTML+=`<div class="colour-input-row"><label for="c-${key}-text">${colourLabels[key]}:</label><div class="colour-input-group"><input type="text" id="c-${key}-text" oninput="updateColour('${key}',this.value)"><input type="color" id="c-${key}-color" oninput="updateColour('${key}',this.value)"></div></div>`});colourMenu.innerHTML=colourMenuHTML;const initValues={i:'key',m:'model',cid:'chatid',p:'parse',st:'stream',si:'ms',savesettings:'savesettings',savechat:'savechat'};Object.entries(initValues).forEach(([id,key])=>g(id)[id==='p'||id==='st'||id.startsWith('save')?'checked':'value']=s[key]);g('si').disabled=!s.stream;Object.entries(s.colours).forEach(([key,value])=>updateColour(key,value,false));renderHistory()};window.onclick=function(event){if(!event.target.closest('.dropdown-container')&&!event.target.closest('.colours-dropdown-container')){g('id-dropdown-menu').classList.remove('show');g('colours-dropdown').classList.remove('show')}};initComponents();</script></body></html>
