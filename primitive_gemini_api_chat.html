<!DOCTYPE html><html><head><title>AI Chat</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}body{font-family:monospace;margin:10px}.container{display:flex;align-items:center;flex-wrap:wrap;margin-bottom:10px}.control-group{display:inline-flex;align-items:center;gap:2px;margin-right:3px;margin-bottom:10px}input,textarea,button{background-color:#333;color:#e0e0e0;border:1px solid #555;padding:8px}textarea,button{width:100%;margin-bottom:10px}button{cursor:pointer}button:disabled{background-color:#222;color:#777}.container input[type="text"],.container input[type="number"]{field-sizing:content}input:disabled{background-color:#2a2a2a;color:#888}#b{height:65vh;overflow-y:scroll;border:1px solid;padding:10px;margin:10px 0}#b pre{white-space:pre-wrap;margin:5px 0;padding:4px;border:1px solid}code{background-color:transparent;padding:1px 4px;border-radius:4px}.dropdown-container,.colours-dropdown-container{position:relative;display:inline-flex;align-items:center}#chatid{padding-right:25px}#id-dropdown-btn{position:absolute;right:0;top:0;bottom:0;display:flex;align-items:center;width:25px;justify-content:center;cursor:pointer;user-select:none}.dropdown-content{display:none;position:absolute;top:100%;left:0;background-color:#444;min-width:160px;border:1px solid #555;z-index:1;max-height:80vh;overflow-y:auto}.dropdown-content div{color:#e0e0e0;padding:8px 12px;text-decoration:none;display:block;cursor:pointer}.dropdown-content div:hover{background-color:#555}.show{display:block}#save-btn,#colours-btn{width:auto;margin-bottom:0;padding:4px 8px}.colours-dropdown-content{padding:10px;width:280px}.colour-input-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:1px}.colour-input-group{display:flex;align-items:center;gap:5px}.colour-input-group input[type="text"]{width:100px}.colour-input-group input[type="color"]{width:30px;height:30px;padding:2px;border:1px solid #555;background:none}#b h1,#b h2,#b h3,#b h4,#b h5,#b h6{margin:.8em 0 .4em}#b p{margin:0}#b p+p{margin-top:.5em}#b blockquote{background-color:#2a2a2a;border-left:4px solid #555;border-radius:0 4px 4px 0;margin:10px 0;padding:5px 15px}#b hr{border:0;border-top:1px solid #444;margin:1em 0}#b pre div pre{margin:10px 0;border:1px solid}#b pre div pre code{display:block;padding:10px;border-radius:4px;white-space:pre-wrap;color:#e0e0e0}#b pre > div{display:inline}#b ul{margin:0;padding-left:20px}</style></head><body><div class="container"><span class="control-group"><label for="key">API Key:</label><input type="text" id="key" data-state="key"></span><span class="control-group"><label for="model">Model Name:</label><input type="text" id="model" data-state="model"></span><span class="control-group"><label for="chatid">Chat ID:</label><div class="dropdown-container"><input type="text" id="chatid" data-state="chatid"><label for="chatid" id="id-dropdown-btn" data-action="toggle" data-target="id-dropdown-menu">â–¼</label><div id="id-dropdown-menu" class="dropdown-content"></div></div></span><span class="control-group"><label for="parse">Parse:</label><input type="checkbox" id="parse" data-state="parse"></span><span class="control-group"><label for="stream">Stream:</label><input type="checkbox" id="stream" data-state="stream"></span><span class="control-group"><input type="number" id="ms" data-state="ms">ms</span><span class="control-group"><span><button id="save-btn" data-action="save">Save</button>:</span><label for="savesettings">Settings</label><input type="checkbox" id="savesettings" data-state="savesettings"><label for="savechat">Chat</label><input type="checkbox" id="savechat" data-state="savechat"></span><span class="control-group"><div class="colours-dropdown-container"><button id="colours-btn" data-action="toggle" data-target="colours-dropdown">Colours</button><div id="colours-dropdown" class="dropdown-content colours-dropdown-content"></div></div></span></div><div id="b"></div><textarea id="u" placeholder="Your message..."></textarea><button id="s" data-action="send">Send</button><script>const g=id=>document.getElementById(id),cE=tag=>document.createElement(tag),doc=document,s={},cfg=[{k:'username',l:'User Name',d:'#ff0000',s:'.user-prefix',p:'color'},{k:'modelname',l:'Model Name',d:'#8a2be2',s:'.model-prefix',p:'color'},{k:'usertext',l:'User Text',d:'#00ff00',s:'.user-message',p:'color'},{k:'modeltext',l:'Model Text',d:'#e0e0e0',s:'.model-message',p:'color'},{k:'uitext',l:'UI Text',d:'#e0e0e0',s:'body, input, textarea, button',p:'color'},{k:'userbg',l:'User BG',d:'#1a1a1a',s:'.user-message',p:'backgroundColor'},{k:'modelbg',l:'Model BG',d:'#1a1a1a',s:'.model-message',p:'backgroundColor'},{k:'background',l:'BG',d:'#121212',s:'body',p:'backgroundColor'},{k:'useredge',l:'User Edge',d:'transparent',s:'.user-message',p:'borderColor'},{k:'modeledge',l:'Model Edge',d:'transparent',s:'.model-message',p:'borderColor'},{k:'chatedge',l:'Chat Edge',d:'#444444',s:'#b',p:'borderColor'},{k:'codeblockedges',l:'Codeblock Edge',d:'#444444',s:'#b pre div pre',p:'borderColor'},{k:'codeblockbackground',l:'Codeblock BG',d:'#000000',s:'#b pre div pre code',p:'backgroundColor'}];let h={},cc=[];const pT=text=>{const e=t=>t.replace(/</g,'&lt;'),i=str=>e(str).replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\*(.*?)\*/g,'<em>$1</em>').replace(/`(.*?)`/g,'<code>$1</code>'),l=text.split('\n'),o=[];let iC=!1,iL=!1,lang='',ct=[];const cL=()=>{if(iL){o.push('</ul>');iL=!1}};for(const ln of l){if(iC){if(/^```$/.test(ln)){o.push(`<pre><code class="language-${lang}">${e(ct.join('\n'))}</code></pre>`);iC=!1}else{ct.push(ln)}}else{const lM=ln.match(/^\s*[\*\-\+]\s(.*)/),cM=ln.match(/^```(\w*)/),hM=ln.match(/^(#{1,6})\s(.*)/);if(!lM)cL();if(cM){cL();iC=!0;lang=cM[1]||'';ct=[]}else if(lM){if(!iL){o.push('<ul>');iL=!0}o.push(`<li>${i(lM[1])}</li>`)}else if(hM){o.push(`<h${hM[1].length}>${i(hM[2])}</h${hM[1].length}>`)}else if(/^(---|___|\*\*\*)\s*$/.test(ln)){o.push('<hr>')}else if(ln.startsWith('> ')){o.push(`<blockquote>${i(ln.substring(2))}</blockquote>`)}else if(ln.trim()){o.push(`<p>${i(ln)}</p>`)}}}cL();if(iC)o.push(`<pre><code class="language-${lang}">${e(ct.join('\n'))}</code></pre>`);return o.filter(Boolean).join('').replace(/<\/blockquote><blockquote>/g,'<br>').replace(/<\/p><p>/g,'<br>')},cH=c=>{const t=cE('div');t.style.color=c;doc.body.appendChild(t);const rC=window.getComputedStyle(t).color;t.remove();if(rC.startsWith('#'))return rC;const rgb=rC.match(/\d+/g).map(Number);return`#${((1<<24)+(rgb[0]<<16)+(rgb[1]<<8)+rgb[2]).toString(16).slice(1)}`},rC=(pre,ct,text,iP)=>{pre.style.whiteSpace=iP?'normal':'pre-wrap';ct[iP?'innerHTML':'textContent']=iP?pT(text):text},cME=(role,text)=>{const p=cE('pre'),iU=role==='user',pS=cE('span'),ct=cE('div');p.className=iU?'user-message':'model-message';pS.className=iU?'user-prefix':'model-prefix';pS.textContent=iU?'user: ':`${s.model.replace(/</g,"&lt;")}: `;rC(p,ct,text,!iU&&s.parse);p.append(pS,ct);return p},r=()=>{const b=g('b');b.innerHTML='';cc.length?cc.forEach(msg=>b.appendChild(cME(msg.role,msg.parts[0].text))):b.insertAdjacentHTML('beforeend','<pre>System: Enter API key & ask a question.</pre>');Object.keys(s).forEach(k=>{const el=g(k);if(el)el[el.type==='checkbox'?'checked':'value']=s[k]});g('ms').disabled=!s.stream;g('colours-dropdown').innerHTML=cfg.map(c=>`<div class="colour-input-row"><label>${c.l}:</label><div class="colour-input-group"><input type="text" value="${s.colours[c.k]}" data-state="colours.${c.k}"><input type="color" value="${cH(s.colours[c.k])}" data-state="colours.${c.k}"></div></div>`).join('');cfg.forEach(c=>{doc.querySelectorAll(c.s).forEach(el=>{el.style[c.p]=s.colours[c.k]})})},a={send:async()=>{const uM=g('u').value.trim();if(!s.key||!s.model||!uM)return;const b=g('b'),sB=g('s');b.appendChild(cME('user',uM));const mM=cME('model','...');b.appendChild(mM);r();g('u').value='';sB.disabled=!0;cc.push({role:'user',parts:[{text:uM}]});let fR='';try{const eP=s.stream?'streamGenerateContent?alt=sse&':'generateContent?',res=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${s.model}:${eP}key=${s.key}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:cc})});if(!res.ok)throw new Error((await res.json()).error.message);const uUI=t=>{rC(mM,mM.lastChild,t,s.parse);b.scrollTop=b.scrollHeight};if(s.stream){const rdr=res.body.getReader(),d=new TextDecoder();for(let bf='';;){const{done,value}=await rdr.read();if(done)break;bf+=d.decode(value,{stream:!0});const lns=bf.split('\n');bf=lns.pop();for(const ln of lns)ln.startsWith('data: ')&&(fR+=JSON.parse(ln.substring(6)).candidates?.[0]?.content?.parts?.[0]?.text||'');uUI(fR);if(s.ms>0)await new Promise(r=>setTimeout(r,s.ms))}}else{fR=(await res.json()).candidates[0].content.parts[0].text;uUI(fR)}cc.push({role:'model',parts:[{text:fR}]});a.save()}catch(err){mM.textContent=`${s.model}: Error - ${err.message}`}finally{sB.disabled=!1;g('u').focus()}},save:()=>{if(s.savesettings||s.savechat)localStorage.setItem('chat',JSON.stringify({s:s.savesettings?s:undefined,history:s.savechat?h:undefined}))},toggle:el=>{const t=g(el.dataset.target);if(t.id==='id-dropdown-menu'){t.innerHTML=Object.keys(h).map(id=>`<div data-action="selectChat" data-id="${id}">${id}</div>`).join('')}t.classList.toggle('show')},selectChat:el=>{s.chatid=el.dataset.id;cc=h[s.chatid]||(h[s.chatid]=[]);g('id-dropdown-menu').classList.remove('show');r()}};doc.addEventListener('input',e=>{const kP=e.target.dataset.state;if(!kP)return;const keys=kP.split('.'),val=e.target.type.slice(0,8)==='checkbox'?e.target.checked:e.target.value;let cS=s;for(let i=0;i<keys.length-1;i++)cS=cS[keys[i]];cS[keys[keys.length-1]]=val;r()});doc.addEventListener('click',e=>{const act=e.target.dataset.action;if(a[act])a[act](e.target);if(!e.target.closest('.dropdown-container')&&!e.target.closest('.colours-dropdown-container')){g('id-dropdown-menu').classList.remove('show');g('colours-dropdown').classList.remove('show')}});(()=>{const st=JSON.parse(localStorage.getItem('chat'))||{},sS=st.s||{},sH=st.history||{};Object.assign(s,{key:"",model:"gemini-2.5-pro",chatid:"default",parse:!1,stream:!1,ms:50,savesettings:!0,savechat:!0,...sS});s.colours={...cfg.reduce((a,c)=>({...a,[c.k]:c.d}),{}),...(sS.colours||{})};h=Array.isArray(sH)?confirm("Outdated chat data format. Migrate?")?{default:[],oldlocal:sH}:sH:typeof sH==='object'?sH:{default:[]};cc=h[s.chatid]||(h[s.chatid]=[]);r()})();</script></body></html>
