<!DOCTYPE html><html><head><title>AI Chat</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}body{background-color:#121212;color:#e0e0e0;font-family:monospace;margin:10px}.container{display:flex;align-items:center;flex-wrap:wrap;gap:15px;margin-bottom:10px}.control-group{display:inline-flex;align-items:center}input,textarea,button{background-color:#333;color:#e0e0e0;border:1px solid #555;padding:8px}textarea,button{width:100%;margin-bottom:10px}button{cursor:pointer}button:disabled{background-color:#222;color:#777}.container input[type="text"],.container input[type="number"]{field-sizing:content}input:disabled{background-color:#2a2a2a;color:#888}#b{height:65vh;overflow-y:scroll;border:1px solid #444;padding:10px;margin:10px 0}#b pre{white-space:pre-wrap;margin:5px 0}code{background-color:#000;padding:1px 4px;border-radius:4px}.dropdown-container{position:relative;display:inline-flex;align-items:center}#cid{padding-right:25px}#id-dropdown-btn{position:absolute;right:0;top:0;bottom:0;display:flex;align-items:center;width:25px;justify-content:center;cursor:pointer;user-select:none}.dropdown-content{display:none;position:absolute;top:100%;left:0;background-color:#444;min-width:160px;border:1px solid #555;z-index:1;max-height:200px;overflow-y:auto}.dropdown-content div{color:#e0e0e0;padding:8px 12px;text-decoration:none;display:block;cursor:pointer}.dropdown-content div:hover{background-color:#555}.show{display:block}</style></head><body><div class="container"><label for="i">API Key:</label><input type="text" id="i" oninput="s.key=this.value"></div><div class="container"><label for="m">Model Name:</label><input type="text" id="m" oninput="s.model=this.value"><label for="cid">Chat ID:</label><div class="dropdown-container"><input type="text" id="cid" onchange="switchChat(this.value)"><label for="cid" id="id-dropdown-btn" onclick="toggleIdDropdown()">â–¼</label><div id="id-dropdown-menu" class="dropdown-content"></div></div></div><div class="container"><span class="control-group"><label for="p">Parse:</label><input type="checkbox" id="p" onclick="s.parse=this.checked"></span><span class="control-group"><label for="st">Stream:</label><input type="checkbox" id="st" onclick="s.stream=this.checked;g('si').disabled=!this.checked"></span><span class="control-group"><input type="number" id="si" oninput="s.ms=this.value">ms</span><span class="control-group"><label>Save:</label>&nbsp;<label for="savesettings">Settings</label><input type="checkbox" id="savesettings" onclick="s.savesettings=this.checked">&nbsp;<label for="savechat">Chat</label><input type="checkbox" id="savechat" onclick="s.savechat=this.checked"></span></div><div id="b"></div><textarea id="u" placeholder="Your message..." rows="3"></textarea><button id="s" onclick="(async()=>{const userMessage=g('u').value.trim();if(!s.key||!s.model||!userMessage)return;const b=g('b');b.insertAdjacentHTML('beforeend',`<pre>user: ${userMessage.replace(/</g,'&lt;')}</pre>`);b.insertAdjacentHTML('beforeend',`<pre>${s.model.replace(/</g,'&lt;')}: ...</pre>`);const modelMessage=b.lastChild;g('u').value='',g('s').disabled=!0;currentChat.push({role:'user',parts:[{text:userMessage}]});let fullResponse='';try{const endpoint=s.stream?'streamGenerateContent?alt=sse&':'generateContent?';const response=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${s.model}:${endpoint}key=${s.key}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:currentChat})});if(!response.ok)throw new Error((await response.json()).error.message);const updateUI=text=>{modelMessage.innerHTML=`${s.model.replace(/</g,'&lt;')}: ${s.parse?text.replace(/&g/,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\*\*(.*?)\*\*/g,'<b>$1</b>').replace(/\*(.*?)\*/g,'<i>$1</i>').replace(/`([^`]+)`/g,'<code>$1</code>'):text.replace(/</g,'&lt;')}`;b.scrollTop=b.scrollHeight};if(s.stream){const reader=response.body.getReader(),decoder=new TextDecoder();for(let buffer='';;){const{done,value}=await reader.read();if(done)break;buffer+=decoder.decode(value,{stream:!0});const lines=buffer.split('\n');buffer=lines.pop();for(const line of lines){if(line.startsWith('data: '))fullResponse+=JSON.parse(line.substring(6)).candidates?.[0]?.content?.parts?.[0]?.text||''}
updateUI(fullResponse);if(s.ms>0)await new Promise(r=>setTimeout(r,s.ms))}}else{fullResponse=(await response.json()).candidates[0].content.parts[0].text;updateUI(fullResponse)}currentChat.push({role:'model',parts:[{text:fullResponse}]});saveState()}catch(error){modelMessage.textContent=`${s.model}: Error - ${error.message}`}finally{g('s').disabled=!1,g('u').focus()}})()">Send</button><script>const g=id=>document.getElementById(id);const storedData=JSON.parse(localStorage.getItem('chat'))||{};let historyData=storedData.history;if(Array.isArray(historyData)){if(confirm("Warning: Outdated chat data format detected.\n\nClick OK to migrate your old chat to a new format under the ID 'oldlocal'.\n\nClick Cancel to do nothing (app may not function).")){const preservedChat=historyData;historyData={default:[],oldlocal:preservedChat}}}else if(!historyData||typeof historyData!=='object'){historyData={default:[]}}
const s={key:"",model:"gemini-1.5-flash-latest",chatid:"default",parse:!1,stream:!1,ms:50,savesettings:!1,savechat:!1,...(storedData.s||{})};const history=historyData;let currentChat=history[s.chatid]||[];function renderHistory(){const b=g('b');b.innerHTML='';if(currentChat&&currentChat.length){for(const msg of currentChat){const prefix=msg.role=='user'?'user':s.model;b.insertAdjacentHTML('beforeend',`<pre>${prefix}: ${msg.parts[0].text.replace(/</g,"&lt;")}</pre>`)}}else{b.insertAdjacentHTML('beforeend','<pre>System: Enter API key & ask a question.</pre>')}}
function saveState(){if(!s.savesettings&&!s.savechat)return;const dataToSave={s:s,history:history};localStorage.setItem('chat',JSON.stringify(dataToSave))}
function switchChat(newId){if(!newId||newId===s.chatid)return;s.chatid=newId;if(!history[newId]){history[newId]=[]}
currentChat=history[newId];renderHistory();saveState()}
function toggleIdDropdown(){const menu=g('id-dropdown-menu');menu.innerHTML='';Object.keys(history).forEach(id=>{const item=document.createElement('div');item.textContent=id;item.onclick=()=>{const cidInput=g('cid');cidInput.value=id;cidInput.dispatchEvent(new Event('change'));menu.classList.remove('show')};menu.appendChild(item)});menu.classList.toggle('show')}
window.onclick=function(event){if(!event.target.closest('.dropdown-container')){g('id-dropdown-menu').classList.remove('show')}}
g('i').value=s.key;g('m').value=s.model;g('cid').value=s.chatid;g('p').checked=s.parse;g('st').checked=s.stream;g('si').value=s.ms;g('si').disabled=!s.stream;g('savesettings').checked=s.savesettings;g('savechat').checked=s.savechat;renderHistory();</script></body></html>
